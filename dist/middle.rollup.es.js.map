{"version":3,"file":"middle.rollup.es.js","sources":["../src/middle.src.js"],"sourcesContent":["'use strict'\n\nexport default function middle( fn, ctx ) {\n\n\t// TODO: Consider Enhanced class ---> enhanced = new Enhanaced() ???\n\n\tvar enhanced = middle_enhanced_fn\n\n\tenhanced._m_stack = []\n  enhanced._m_index = 0\n  enhanced._m_ctx = ctx\n\n\tfunction middle_enhanced_fn() {\n\n\t\t// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Functions/arguments#Using_the_Spread_Syntax_with_Arguments\n\t\tconst args = [ ...arguments ]\n\n    if ( !ctx && ( ctx === undefined || ctx === null )){\n      enhanced._m_ctx = ctx = this\n    } else {\n      enhanced._m_ctx = ctx\n    }\n    // console.log('middle_enhanced_fn ctx', ctx )\n\n\t\tif ( enhanced._m_stack.length === enhanced._m_index ) {\n\t\t\tenhanced._m_index = 0\n\t\t\treturn fn.apply( ctx, args )\n\t\t}\n\n\t\targs.unshift( middle_enhanced_fn ) // pass middle_enhanced_fn as \"next\" function in first parameter\n\n\t\treturn enhanced._m_stack[ enhanced._m_index++ ].apply( ctx, args )\n\t}\n\n\tenhanced.use = ( useFn, useCtx, index ) => {\n\n\t\tlet bound\n\n\t\tif ( useCtx !== undefined && useCtx !== null )\n\t\t\tbound = useFn.bind( useCtx )\n\n\t\tif ( typeof index == 'number' )\n\n\t\t\tenhanced._m_stack.splice( index, 0, bound || useFn )\n\n\t\telse\n\n\t\t\tenhanced._m_stack.push( bound || useFn )\n\t}\n\n\tenhanced.subscribe = ( subFn, subCtx, index, onReturn ) => {\n\n\t\tconst used = function( next ) {\n\n\t\t\tconst args = [ ...arguments ]\n\n\t\t\tif ( !subCtx && ( subCtx === undefined || subCtx === null ))\n\t\t\t\tsubCtx = ctx\n\n\t\t\tif ( onReturn ){\n\n\t\t\t\tconst res = next.apply( ctx, args ) // continue chain\n\t\t\t\tsubFn.call( subCtx, res ) // call callback on return path\n\t\t\t\treturn res\n\n\t\t\t} else {\n\n\t\t\t\targs.shift() // remove the \"next\" parameter\n\t\t\t\tsubFn.apply( subCtx, args )\n\t\t\t\targs.unshift( next ) // put the \"next\" parameter back\n\t\t\t\treturn next.apply( ctx, args ) // continue chain\n\t\t\t}\n\n\t\t}\n\n\t\tenhanced.use( used, undefined, index )\n\n\t\treturn used\n\t}\n\n\treturn enhanced\n}\n\n// ES7 decorator ( https://www.martin-brennan.com/es7-decorators/ )\nexport function decorator( target, key, descriptor ) {\n\n\tif ( !target ) return\n\n\tconst { writable, enumerable } = descriptor\n\n\treturn {\n\t\tget: function () {\n\n\t\t\tconst newEnhanced = middle( descriptor.value )\n\t\t\tObject.defineProperty( this, key, {\n\t\t\t\tvalue: newEnhanced,\n\t\t\t\twritable: writable,\n\t\t\t\tenumerable: enumerable\n\t\t\t} )\n\n\t\t\treturn newEnhanced\n\t\t}\n\t}\n}\n"],"names":["middle","fn","ctx","middle_enhanced_fn","args","arguments","_m_ctx","undefined","this","enhanced","_m_stack","length","_m_index","apply","unshift","use","useFn","useCtx","index","bound","bind","splice","push","subscribe","subFn","subCtx","onReturn","used","next","res","call","shift","decorator","target","key","descriptor","writable","enumerable","newEnhanced","value","defineProperty"],"mappings":"AAEe,QAASA,QAAQC,EAAIC,WAU1BC,QAGFC,wCAAYC,qBAKLC,OAHLJ,OAAiBK,KAARL,GAA6B,OAARA,EAGhBA,EAFAA,EAAMM,KAMvBC,EAASC,SAASC,SAAWF,EAASG,YACjCA,SAAW,EACbX,EAAGY,MAAOX,EAAKE,OAGlBU,QAASX,GAEPM,EAASC,SAAUD,EAASG,YAAaC,MAAOX,EAAKE,OAzBzDK,GAAWN,WAENO,cACCE,SAAW,IACXN,OAASJ,IAwBVa,IAAM,SAAEC,EAAOC,EAAQC,MAE3BC,cAEYZ,KAAXU,GAAmC,OAAXA,IAC5BE,EAAQH,EAAMI,KAAMH,IAEA,gBAATC,GAEXT,EAASC,SAASW,OAAQH,EAAO,EAAGC,GAASH,GAI7CP,EAASC,SAASY,KAAMH,GAASH,MAG1BO,UAAY,SAAEC,EAAOC,EAAQP,EAAOQ,MAEtCC,GAAO,SAAUC,MAEhBxB,wCAAYC,eAEZoB,OAAuBlB,KAAXkB,GAAmC,OAAXA,IACzCA,EAASvB,GAELwB,EAAU,IAERG,GAAMD,EAAKf,MAAOX,EAAKE,YACvB0B,KAAML,EAAQI,GACbA,WAIFE,UACClB,MAAOY,EAAQrB,KAChBU,QAASc,GACPA,EAAKf,MAAOX,EAAKE,aAKjBW,IAAKY,MAAMpB,GAAWW,GAExBS,GAGDlB,EAIR,QAAgBuB,WAAWC,EAAQC,EAAKC,MAEjCF,MAEEG,GAAyBD,EAAzBC,SAAUC,EAAeF,EAAfE,sBAGZ,cAEEC,GAActC,OAAQmC,EAAWI,qBAChCC,eAAgBhC,KAAM0B,SACrBI,WACGF,aACEC,IAGNC"}